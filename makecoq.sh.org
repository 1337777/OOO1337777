#+BEGIN_SRC bash
#!/bin/bash

echo -n -e "\n--8<--COQ--${1}--COQ-->8--\n" ;
pgrep -d ' ' -f '\.makecoq\.sh.+' | sed "s/\\b${$}\\b//" | xargs ./.anywait.sh ;

cd /home/ubuntu/OOO1337777/repocache ;

touch ./.coqignore ;

while [ 1 ] ; do

    ( echo '-R . OOO1337777 ' ;    \
      find . -regex '.*\.v' \( -exec grep -q -s '{}' .coqignore \; -prune -o -print \) ) > _CoqProject ;

    coq_makefile -f _CoqProject -o Makefile ;
    
    resu=$( make -j 2 2>&1 | sed -n 's/^make: \*\*\* \[\(.\+\.v\)o\] Error.*/\1/p' ) ;
    
    if [[ -n $resu ]] ; then
	echo "./${resu}" >> .coqignore ;
    else
	break ;
    fi	     
done

cp ./.coqignore "./.${1}.coqignore" ;

echo -n -e "\n--8<--COQFINISH--${1}--COQFINISH-->8--\n" ;

#+END_SRC
